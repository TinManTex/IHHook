# Notes for developers
Further notes at top of IHHook.h

## Developing a new IHHook version:

Work for a new version should be done on a seperate development branch than main.

Bump the Version in IHHook.h and FileVersion in Resource Files/IHHook.rc

Try and get some Modders Heaven community members to test build builds for you
https://discord.gg/3rVFWf2vbj

## Documentation:
Make sure Changelog.txt has a synopsis of major changes.
Copy the latest changelog on to the top of the ReadMe.md
As Readme.md is coppied to txt (since most users wont have the filetype associated to open it) remember to add two spaces at the end of lines you want to linebreak in .md rather than double breaking which will space out txt weird.
The readme should be directly copied into into the nexusmods description page on release.

## Releases:
Make sure VS is set to release build.
Visual Studio post-build step should copy and rename the dll to the makebite folder.
It also copies ReadMe.md and Changelog.md to makebite/GameDir/mod/docs
Simply use makebite on the makebite folder.
And zip the .mgsv

Compare the .mgsv against a previous build
and test installation for good measure.

When you're sure of a release make a pull of the development branch to main.

## Exporting functions to hook
IHHook has a ghidra script to export function signatures/addresses for IHHook.
Get access to the mgsv ghidra project by asking at the Modders Heaven discord.
Read the notes in IHHook\ghidra\ExportInfo.py
Specifically about committing the function parameter types in ghidra for the function you want.
Add an entry to ExportInfo.py (again follow the notes)
Run IHHook\ghidra\ExportHooksToHeader.py in ghidra via
window menu > script manager, 
find the manage script directories and point it to IHHook/ghidra folder, 
then find the script in scripts\IHHook (or type in the name in filter).

## Community NOTE: 
IHHook developers, on Ghidra server please set a Plate Comment of "IHHook Export" on the function you want to export: 
(on the actual function, not its thunk)
Select the function name in ghidra and press semicolon (;), or right click > comments > plate comment.
and also bookmark (select the start of function address in listing and ctrl D) with the category of IHHook. 
This is just to make it clearer in case someone is reworking the function that it will impact the IHHook project.

General community working on ghidra server: If you change the name or signature of an IHHook export please mention it on the MH discord.

## Fixing ghidra server function changes
It's possible that another community member may rename/rework a function that IHHook exports.
(Though hopefully with the above commenting and and awareness of the issue it won't happen unanounced).
In this case you'll want to keep the previous version of IHHook\hooks\mgsv_tpp_address_*.h (or rely on github diff) and compare against what is labelled missing after running ExportHooksToHeader again. 
Then you can use the previous versions addresses to locate the functions again and find their new names and update ExportInfo and run again. And diff again to see if the function signatures have also changed (though errors on your hooked functions will usually be a tip off).

## Using IHHook lua functions:
Lua code can check for the global _IHHook to see if IHHook is running. It will be nil if not, or the IHHook version number if so.
Which you can also use to guard against user running versions before the IHHook functions you're using.
IH menus and Ivars can set a .requiresIHHook bool to exclude themselves if IHH is not running.

